<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255,255,255,0.7); display: flex; justify-content: center; align-items: center; z-index: 50; }
    .hidden { display: none !important; }
  </style>
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
  <div id="loading" class="loading-overlay hidden">
    <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"></div>
  </div>

  <div class="max-w-7xl mx-auto bg-white min-h-screen shadow-lg">
    <header class="bg-blue-700 text-white p-4 flex justify-between items-center">
      <h1 class="text-xl font-bold"><i class="fas fa-gas-pump text-yellow-400 mr-2"></i>SS設備管理システム v6.0</h1>
    </header>

    <nav class="flex border-b overflow-x-auto bg-white sticky top-0 z-10 shadow-sm">
      <button onclick="navigate('progress')" id="nav-progress" class="nav-btn px-4 py-3 font-medium hover:bg-gray-50 border-b-2 border-transparent text-gray-600 whitespace-nowrap"><i class="fas fa-tasks mr-2"></i>案件管理</button>
      <button onclick="navigate('dashboard')" id="nav-dashboard" class="nav-btn px-4 py-3 font-medium hover:bg-gray-50 border-b-2 border-transparent text-gray-600 whitespace-nowrap"><i class="fas fa-chart-pie mr-2"></i>ダッシュボード</button>
      <button onclick="navigate('list')" id="nav-list" class="nav-btn px-4 py-3 font-medium hover:bg-gray-50 border-b-2 border-transparent text-gray-600 whitespace-nowrap"><i class="fas fa-list mr-2"></i>設備一覧</button>
      <button onclick="navigate('email')" id="nav-email" class="nav-btn px-4 py-3 font-medium hover:bg-gray-50 border-b-2 border-transparent text-gray-600 whitespace-nowrap"><i class="fas fa-envelope mr-2"></i>メール作成</button>
      <button onclick="navigate('import')" id="nav-import" class="nav-btn px-4 py-3 font-medium hover:bg-gray-50 border-b-2 border-transparent text-gray-600 whitespace-nowrap"><i class="fas fa-file-import mr-2"></i>見積取込</button>
    </nav>

    <div class="p-6">
      <div id="view-progress" class="view-section"><?!= include('project-progress'); ?></div>
      <div id="view-dashboard" class="view-section hidden"><?!= include('dashboard'); ?></div>
      <div id="view-list" class="view-section hidden"><?!= include('equipment-list'); ?></div>
      <div id="view-email" class="view-section hidden"><?!= include('email-draft'); ?></div>
      <div id="view-import" class="view-section hidden"><?!= include('import'); ?></div>
    </div>
  </div>

  <?!= include('complete'); ?>

  <script>
    window.g_cache = {};
    function navigate(viewId) {
      document.querySelectorAll('.view-section').forEach(el => el.classList.add('hidden'));
      document.querySelectorAll('.nav-btn').forEach(el => {
        el.classList.remove('border-blue-600', 'text-blue-600');
        el.classList.add('border-transparent', 'text-gray-600');
      });
      const target = document.getElementById('view-' + viewId);
      if(target) target.classList.remove('hidden');
      const btn = document.getElementById('nav-' + viewId);
      if(btn) {
        btn.classList.remove('border-transparent', 'text-gray-600');
        btn.classList.add('border-blue-600', 'text-blue-600');
      }
      if (viewId === 'progress' && window.progressInit) progressInit(false);
      if (viewId === 'dashboard' && window.dashboardInit) dashboardInit(false);
      if (viewId === 'list' && window.listInit) listInit(false);
      if (viewId === 'email' && window.emailInit) emailInit(false);
      if (viewId === 'import' && window.importInit) importInit(false);
    }
    function showLoading(show) { document.getElementById('loading').classList.toggle('hidden', !show); }
    function clearCache(key) { if (key) delete window.g_cache[key]; else window.g_cache = {}; }
    navigate('progress');
  </script>
</body>
</html>